(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[895],{9589:function(e,t,n){Promise.resolve().then(n.bind(n,2150))},3880:function(e,t,n){"use strict";n.d(t,{default:function(){return s.a}});var r=n(12),s=n.n(r)},2150:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(7110),s=n(90),a=n(5977),c=n.n(a),o=n(4648),l=n(6871),i=n(3880),d=n(9465),u=n(4513),m=n(7437);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,u.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var b=function(e){var t,n,a,i=e.projects,u=e.groupBy,p=e.onProjectUpdated,b=(0,o.createClientComponentClient)(),f=(0,l.useState)(i),h=f[0],g=f[1],j=(0,l.useState)(!1),v=j[0],y=j[1],N=(0,l.useState)(!1),w=N[0],k=N[1],_=(0,l.useState)(null),C=_[0],S=_[1],O=(0,l.useState)(""),P=O[0],D=O[1],E=(0,l.useState)(""),A=E[0],F=E[1];(0,l.useEffect)(function(){g(i)},[i]);var L=function(e,t){e.dataTransfer.setData("projectId",t.id)},U=function(e){e.preventDefault()},Z=(t=(0,s.Z)(c().mark(function e(t,n){var r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=t.dataTransfer.getData("projectId"),g(h.map(function(e){return e.id===r?x(x({},e),{},{status:n}):e})),e.prev=4,console.log("Attempting to update project ".concat(r," to status ").concat(n)),e.next=8,d.k.updateProject(r,{status:n},b);case 8:p(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Error updating project status:",e.t0),"PGRST116"===e.t0.code&&console.error("Supabase Error PGRST116: Project not found or RLS policy denied update. Check project ID and RLS policies."),g(i);case 16:case"end":return e.stop()}},e,null,[[4,11]])})),function(e,n){return t.apply(this,arguments)}),z=(n=(0,s.Z)(c().mark(function e(t){var n,s,a,o,l,i,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=(s=new FormData(n=t.currentTarget)).get("projectName"),o=s.get("projectLocation"),l=parseFloat(s.get("projectSize")),i={name:a,location:o,asset_class:"Unknown",status:"planning",mcda_score:parseFloat((10*Math.random()).toFixed(1)),coordinates:{x:0,y:0},budget:0,area_total:l,units_count:0,floors_count:0},e.prev=8,e.next=11,d.k.createProject(i,b);case 11:u=e.sent,g(function(e){return[].concat((0,r.Z)(e),[u])}),p(),y(!1),n.reset(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(8),console.error("Error adding new project:",e.t0);case 21:case"end":return e.stop()}},e,null,[[8,18]])})),function(e){return n.apply(this,arguments)}),T=function(e){S(e),F(e.created_by||"Unassigned"),k(!0)},q=(a=(0,s.Z)(c().mark(function e(t){var n,r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!C){e.next=15;break}return F(n=t.target.value),S(r=x(x({},C),{},{created_by:n})),g(function(e){return e.map(function(e){return e.id===r.id?r:e})}),e.prev=6,e.next=9,d.k.updateProject(C.id,{created_by:n},b);case 9:p(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),console.error("Error assigning team member:",e.t0);case 15:case"end":return e.stop()}},e,null,[[6,12]])})),function(e){return a.apply(this,arguments)}),B=(0,l.useCallback)(function(){var e={};return h.forEach(function(t){var n="status"===u?t.status:t.asset_class;e[n]||(e[n]=[]),e[n].push(t)}),e},[h,u]),R="status"===u?["planning","active","under_review","suspended","completed"]:(0,r.Z)(new Set(h.map(function(e){return e.asset_class}))).sort();return(0,m.jsxs)("div",{className:"flex-1 p-4 overflow-auto",children:[(0,m.jsx)("div",{id:"kanban-board",className:"grid grid-cols-1 md:grid-cols-4 gap-4 h-full",children:R.map(function(e){var t;return(0,m.jsxs)("div",{className:"kanban-column bg-gray-200 rounded-lg p-3 shadow-md",onDragOver:U,onDrop:function(t){return Z(t,e)},children:[(0,m.jsxs)("h2",{className:"text-lg font-semibold mb-3 flex justify-between items-center",children:[e.replace(/_/g," ").toUpperCase(),"planning"===e&&(0,m.jsx)("button",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xl leading-none",onClick:function(){return y(!0)},children:"+"})]}),(0,m.jsx)("div",{className:"kanban-cards space-y-3 min-h-[100px]",children:null===(t=B()[e])||void 0===t?void 0:t.map(function(e){var t;return(0,m.jsxs)("div",{className:"kanban-card bg-white p-4 rounded-lg shadow-md cursor-grab",draggable:!0,onDragStart:function(t){return L(t,e)},onClick:function(){return T(e)},children:[(0,m.jsx)("h3",{className:"font-semibold text-lg mb-1",children:e.name}),(0,m.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[e.asset_class," | ",e.location]}),(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(null==(t=e.mcda_score)?"bg-gray-400":t>7.5?"bg-green-500":t>=6?"bg-yellow-500":"bg-red-500"," flex items-center justify-center text-white font-bold text-sm"),children:void 0!==e.mcda_score&&null!==e.mcda_score?e.mcda_score.toFixed(1):"N/A"}),(0,m.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center text-white text-sm",children:e.created_by?e.created_by.charAt(0).toUpperCase():"U"})]})]},e.id)})})]},e)})}),v&&(0,m.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,m.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/3",children:[(0,m.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Add New Opportunity"}),(0,m.jsxs)("form",{onSubmit:z,children:[(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("label",{htmlFor:"projectName",className:"block text-gray-700 text-sm font-bold mb-2",children:"Project Name:"}),(0,m.jsx)("input",{type:"text",id:"projectName",name:"projectName",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("label",{htmlFor:"projectLocation",className:"block text-gray-700 text-sm font-bold mb-2",children:"Location:"}),(0,m.jsx)("input",{type:"text",id:"projectLocation",name:"projectLocation",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("label",{htmlFor:"projectSize",className:"block text-gray-700 text-sm font-bold mb-2",children:"Size (sqm):"}),(0,m.jsx)("input",{type:"number",id:"projectSize",name:"projectSize",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,m.jsxs)("div",{className:"flex justify-end",children:[(0,m.jsx)("button",{type:"button",className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-md mr-2",onClick:function(){return y(!1)},children:"Cancel"}),(0,m.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"Add Project"})]})]})]})}),w&&C&&(0,m.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,m.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/2",children:[(0,m.jsx)("h3",{className:"text-xl font-bold mb-4",children:C.name}),(0,m.jsxs)("p",{className:"text-gray-600 mb-2",children:[C.asset_class," | ",C.location]}),(0,m.jsxs)("p",{className:"text-gray-600 mb-4",children:["GEOCUBO Score: ",void 0!==C.mcda_score&&null!==C.mcda_score?C.mcda_score.toFixed(1):"N/A"]}),(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("label",{htmlFor:"assign-team-member",className:"block text-gray-700 text-sm font-bold mb-2",children:"Assign Team Member:"}),(0,m.jsx)("select",{id:"assign-team-member",className:"p-2 border rounded-md w-full",value:A,onChange:q,children:["Alice","Bob","Charlie","David"].map(function(e){return(0,m.jsx)("option",{value:e,children:e},e)})})]}),(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("h4",{className:"text-lg font-semibold mb-2",children:"Comments:"}),(0,m.jsx)("div",{className:"border p-3 rounded-md h-32 overflow-y-auto mb-3",children:C.comments&&C.comments.length>0?C.comments.map(function(e,t){return(0,m.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 rounded-md",children:[(0,m.jsxs)("p",{className:"font-semibold text-sm",children:[e.author," ",(0,m.jsx)("span",{className:"text-gray-500 text-xs",children:e.timestamp})]}),(0,m.jsx)("p",{className:"text-gray-800",children:e.text})]},t)}):(0,m.jsx)("p",{className:"text-gray-500",children:"No comments yet."})}),(0,m.jsx)("textarea",{id:"new-comment",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:2,placeholder:"Add a comment...",value:P,onChange:function(e){return D(e.target.value)}}),(0,m.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-md mt-2",onClick:function(){if(C&&P.trim()){var e=x(x({},C),{},{comments:[].concat((0,r.Z)(C.comments||[]),[{author:"Current User",text:P.trim(),timestamp:new Date().toLocaleString()}])});S(e),g(function(t){return t.map(function(t){return t.id===e.id?e:t})}),D("")}},children:"Post Comment"})]}),(0,m.jsx)("div",{className:"flex justify-end",children:(0,m.jsx)("button",{type:"button",className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-md",onClick:function(){k(!1),S(null),D("")},children:"Close"})})]})})]})},f=function(){var e=(0,o.createClientComponentClient)(),t=(0,l.useState)([]),n=t[0],a=t[1],u=(0,l.useState)(!0),p=u[0],x=u[1],f=(0,l.useState)("list"),h=f[0],g=f[1],j=(0,l.useState)("status"),v=j[0],y=j[1],N=(0,l.useCallback)((0,s.Z)(c().mark(function t(){return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d.k.getProjects(void 0,void 0,e);case 3:a(t.sent),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error fetching projects:",t.t0);case 10:return t.prev=10,x(!1),t.finish(10);case 13:case"end":return t.stop()}},t,null,[[0,7,10,13]])})),[e]);(0,l.useEffect)(function(){N()},[N]);var w=function(e){switch(null==e?void 0:e.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"planning":return"bg-blue-100 text-blue-800";case"under_review":return"bg-yellow-100 text-yellow-800";case"suspended":return"bg-red-100 text-red-800";case"completed":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return(0,m.jsxs)("div",{className:"container-urbop py-12",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,m.jsx)("h1",{className:"section-title",children:"Proyectos"}),(0,m.jsxs)("div",{className:"flex space-x-4",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("button",{className:"btn ".concat("list"===h?"btn-primary":"btn-outline"),onClick:function(){return g("list")},children:"Lista"}),(0,m.jsx)("button",{className:"btn ".concat("kanban"===h?"btn-primary":"btn-outline"),onClick:function(){return g("kanban")},children:"Kanban"})]}),"kanban"===h&&(0,m.jsxs)("select",{value:v,onChange:function(e){return y(e.target.value)},className:"p-2 border rounded-md",children:[(0,m.jsx)("option",{value:"status",children:"Agrupar por Estado"}),(0,m.jsx)("option",{value:"asset_class",children:"Agrupar por Clase de Activo"})]}),(0,m.jsx)(i.default,{href:"/projects/new",className:"btn btn-primary",children:"Nuevo Proyecto"})]})]}),p?(0,m.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:(0,r.Z)(Array(6)).map(function(e,t){return(0,m.jsxs)("div",{className:"card animate-pulse",children:[(0,m.jsx)("div",{className:"h-48 bg-gray-200 rounded-t-xl"}),(0,m.jsxs)("div",{className:"card-body",children:[(0,m.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-4"}),(0,m.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]},t)})}):"list"===h?(0,m.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:n.map(function(e){return(0,m.jsx)(i.default,{href:"/projects/".concat(e.id),children:(0,m.jsx)("div",{className:"card cursor-pointer",children:(0,m.jsxs)("div",{className:"card-body",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,m.jsx)("h2",{className:"text-xl font-bold",children:e.name}),(0,m.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(w(e.status)),children:e.status})]}),(0,m.jsx)("p",{className:"text-gray-600",children:e.location}),(0,m.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,m.jsx)("span",{className:"text-gray-500",children:e.asset_class}),(0,m.jsx)("span",{className:"text-lg font-bold text-lime-600",children:null!==e.mcda_score&&void 0!==e.mcda_score?e.mcda_score.toFixed(1):"N/A"})]})]})})},e.id)})}):(0,m.jsx)(b,{projects:n,groupBy:v,onProjectUpdated:N})]})}}},function(e){e.O(0,[762,14,12,648,465,971,529,744],function(){return e(e.s=9589)}),_N_E=e.O()}]);