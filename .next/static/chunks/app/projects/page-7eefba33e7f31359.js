(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[895],{9589:function(e,t,n){Promise.resolve().then(n.bind(n,2150))},3880:function(e,t,n){"use strict";n.d(t,{default:function(){return s.a}});var r=n(12),s=n.n(r)},2150:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n(7110),s=n(90),a=n(5977),c=n.n(a),o=n(6871),l=n(3880),i=n(417),d=n(4513),u=n(7437);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var x=function(e){var t,n,a,l=e.projects,d=e.groupBy,m=e.onProjectUpdated,x=(0,o.useState)(l),b=x[0],f=x[1],h=(0,o.useState)(!1),g=h[0],j=h[1],v=(0,o.useState)(!1),y=v[0],N=v[1],w=(0,o.useState)(null),k=w[0],_=w[1],S=(0,o.useState)(""),C=S[0],O=S[1],P=(0,o.useState)(""),D=P[0],E=P[1];(0,o.useEffect)(function(){f(l)},[l]);var A=function(e,t){e.dataTransfer.setData("projectId",t.id)},F=function(e){e.preventDefault()},L=(t=(0,s.Z)(c().mark(function e(t,n){var r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=t.dataTransfer.getData("projectId"),f(b.map(function(e){return e.id===r?p(p({},e),{},{status:n}):e})),e.prev=4,console.log("Attempting to update project ".concat(r," to status ").concat(n)),e.next=8,i.k.updateProject(r,{status:n});case 8:m(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("Error updating project status:",e.t0),"PGRST116"===e.t0.code&&console.error("Supabase Error PGRST116: Project not found or RLS policy denied update. Check project ID and RLS policies."),f(l);case 16:case"end":return e.stop()}},e,null,[[4,11]])})),function(e,n){return t.apply(this,arguments)}),U=(n=(0,s.Z)(c().mark(function e(t){var n,s,a,o,l,d,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=(s=new FormData(n=t.currentTarget)).get("projectName"),o=s.get("projectLocation"),l=parseFloat(s.get("projectSize")),d={name:a,location:o,asset_class:"Unknown",status:"planning",mcda_score:parseFloat((10*Math.random()).toFixed(1)),coordinates:{x:0,y:0},budget:0,area_total:l,units_count:0,floors_count:0},e.prev=8,e.next=11,i.k.createProject(d);case 11:u=e.sent,f(function(e){return[].concat((0,r.Z)(e),[u])}),m(),j(!1),n.reset(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(8),console.error("Error adding new project:",e.t0);case 21:case"end":return e.stop()}},e,null,[[8,18]])})),function(e){return n.apply(this,arguments)}),Z=function(e){_(e),E(e.created_by||"Unassigned"),N(!0)},z=(a=(0,s.Z)(c().mark(function e(t){var n,r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=15;break}return E(n=t.target.value),_(r=p(p({},k),{},{created_by:n})),f(function(e){return e.map(function(e){return e.id===r.id?r:e})}),e.prev=6,e.next=9,i.k.updateProject(k.id,{created_by:n});case 9:m(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),console.error("Error assigning team member:",e.t0);case 15:case"end":return e.stop()}},e,null,[[6,12]])})),function(e){return a.apply(this,arguments)}),T=(0,o.useCallback)(function(){var e={};return b.forEach(function(t){var n="status"===d?t.status:t.asset_class;e[n]||(e[n]=[]),e[n].push(t)}),e},[b,d]),q="status"===d?["planning","active","under_review","suspended","completed"]:(0,r.Z)(new Set(b.map(function(e){return e.asset_class}))).sort();return(0,u.jsxs)("div",{className:"flex-1 p-4 overflow-auto",children:[(0,u.jsx)("div",{id:"kanban-board",className:"grid grid-cols-1 md:grid-cols-4 gap-4 h-full",children:q.map(function(e){var t;return(0,u.jsxs)("div",{className:"kanban-column bg-gray-200 rounded-lg p-3 shadow-md",onDragOver:F,onDrop:function(t){return L(t,e)},children:[(0,u.jsxs)("h2",{className:"text-lg font-semibold mb-3 flex justify-between items-center",children:[e.replace(/_/g," ").toUpperCase(),"planning"===e&&(0,u.jsx)("button",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xl leading-none",onClick:function(){return j(!0)},children:"+"})]}),(0,u.jsx)("div",{className:"kanban-cards space-y-3 min-h-[100px]",children:null===(t=T()[e])||void 0===t?void 0:t.map(function(e){var t;return(0,u.jsxs)("div",{className:"kanban-card bg-white p-4 rounded-lg shadow-md cursor-grab",draggable:!0,onDragStart:function(t){return A(t,e)},onClick:function(){return Z(e)},children:[(0,u.jsx)("h3",{className:"font-semibold text-lg mb-1",children:e.name}),(0,u.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[e.asset_class," | ",e.location]}),(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(null==(t=e.mcda_score)?"bg-gray-400":t>7.5?"bg-green-500":t>=6?"bg-yellow-500":"bg-red-500"," flex items-center justify-center text-white font-bold text-sm"),children:void 0!==e.mcda_score&&null!==e.mcda_score?e.mcda_score.toFixed(1):"N/A"}),(0,u.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center text-white text-sm",children:e.created_by?e.created_by.charAt(0).toUpperCase():"U"})]})]},e.id)})})]},e)})}),g&&(0,u.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,u.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/3",children:[(0,u.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Add New Opportunity"}),(0,u.jsxs)("form",{onSubmit:U,children:[(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{htmlFor:"projectName",className:"block text-gray-700 text-sm font-bold mb-2",children:"Project Name:"}),(0,u.jsx)("input",{type:"text",id:"projectName",name:"projectName",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{htmlFor:"projectLocation",className:"block text-gray-700 text-sm font-bold mb-2",children:"Location:"}),(0,u.jsx)("input",{type:"text",id:"projectLocation",name:"projectLocation",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{htmlFor:"projectSize",className:"block text-gray-700 text-sm font-bold mb-2",children:"Size (sqm):"}),(0,u.jsx)("input",{type:"number",id:"projectSize",name:"projectSize",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,u.jsxs)("div",{className:"flex justify-end",children:[(0,u.jsx)("button",{type:"button",className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-md mr-2",onClick:function(){return j(!1)},children:"Cancel"}),(0,u.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"Add Project"})]})]})]})}),y&&k&&(0,u.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,u.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/2",children:[(0,u.jsx)("h3",{className:"text-xl font-bold mb-4",children:k.name}),(0,u.jsxs)("p",{className:"text-gray-600 mb-2",children:[k.asset_class," | ",k.location]}),(0,u.jsxs)("p",{className:"text-gray-600 mb-4",children:["GEOCUBO Score: ",void 0!==k.mcda_score&&null!==k.mcda_score?k.mcda_score.toFixed(1):"N/A"]}),(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{htmlFor:"assign-team-member",className:"block text-gray-700 text-sm font-bold mb-2",children:"Assign Team Member:"}),(0,u.jsx)("select",{id:"assign-team-member",className:"p-2 border rounded-md w-full",value:D,onChange:z,children:["Alice","Bob","Charlie","David"].map(function(e){return(0,u.jsx)("option",{value:e,children:e},e)})})]}),(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("h4",{className:"text-lg font-semibold mb-2",children:"Comments:"}),(0,u.jsx)("div",{className:"border p-3 rounded-md h-32 overflow-y-auto mb-3",children:k.comments&&k.comments.length>0?k.comments.map(function(e,t){return(0,u.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 rounded-md",children:[(0,u.jsxs)("p",{className:"font-semibold text-sm",children:[e.author," ",(0,u.jsx)("span",{className:"text-gray-500 text-xs",children:e.timestamp})]}),(0,u.jsx)("p",{className:"text-gray-800",children:e.text})]},t)}):(0,u.jsx)("p",{className:"text-gray-500",children:"No comments yet."})}),(0,u.jsx)("textarea",{id:"new-comment",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:2,placeholder:"Add a comment...",value:C,onChange:function(e){return O(e.target.value)}}),(0,u.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-md mt-2",onClick:function(){if(k&&C.trim()){var e=p(p({},k),{},{comments:[].concat((0,r.Z)(k.comments||[]),[{author:"Current User",text:C.trim(),timestamp:new Date().toLocaleString()}])});_(e),f(function(t){return t.map(function(t){return t.id===e.id?e:t})}),O("")}},children:"Post Comment"})]}),(0,u.jsx)("div",{className:"flex justify-end",children:(0,u.jsx)("button",{type:"button",className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-md",onClick:function(){N(!1),_(null),O("")},children:"Close"})})]})})]})},b=function(){var e=(0,o.useState)([]),t=e[0],n=e[1],a=(0,o.useState)(!0),d=a[0],m=a[1],p=(0,o.useState)("list"),b=p[0],f=p[1],h=(0,o.useState)("status"),g=h[0],j=h[1],v=(0,o.useCallback)((0,s.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.k.getProjects();case 3:n(e.sent),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching projects:",e.t0);case 10:return e.prev=10,m(!1),e.finish(10);case 13:case"end":return e.stop()}},e,null,[[0,7,10,13]])})),[]);(0,o.useEffect)(function(){v()},[v]);var y=function(e){switch(null==e?void 0:e.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"planning":return"bg-blue-100 text-blue-800";case"under_review":return"bg-yellow-100 text-yellow-800";case"suspended":return"bg-red-100 text-red-800";case"completed":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return(0,u.jsxs)("div",{className:"container-urbop py-12",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,u.jsx)("h1",{className:"section-title",children:"Proyectos"}),(0,u.jsxs)("div",{className:"flex space-x-4",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("button",{className:"btn ".concat("list"===b?"btn-primary":"btn-outline"),onClick:function(){return f("list")},children:"Lista"}),(0,u.jsx)("button",{className:"btn ".concat("kanban"===b?"btn-primary":"btn-outline"),onClick:function(){return f("kanban")},children:"Kanban"})]}),"kanban"===b&&(0,u.jsxs)("select",{value:g,onChange:function(e){return j(e.target.value)},className:"p-2 border rounded-md",children:[(0,u.jsx)("option",{value:"status",children:"Agrupar por Estado"}),(0,u.jsx)("option",{value:"asset_class",children:"Agrupar por Clase de Activo"})]}),(0,u.jsx)(l.default,{href:"/projects/new",className:"btn btn-primary",children:"Nuevo Proyecto"})]})]}),d?(0,u.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:(0,r.Z)(Array(6)).map(function(e,t){return(0,u.jsxs)("div",{className:"card animate-pulse",children:[(0,u.jsx)("div",{className:"h-48 bg-gray-200 rounded-t-xl"}),(0,u.jsxs)("div",{className:"card-body",children:[(0,u.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-4"}),(0,u.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]},t)})}):"list"===b?(0,u.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map(function(e){return(0,u.jsx)(l.default,{href:"/projects/".concat(e.id),children:(0,u.jsx)("div",{className:"card cursor-pointer",children:(0,u.jsxs)("div",{className:"card-body",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,u.jsx)("h2",{className:"text-xl font-bold",children:e.name}),(0,u.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(y(e.status)),children:e.status})]}),(0,u.jsx)("p",{className:"text-gray-600",children:e.location}),(0,u.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,u.jsx)("span",{className:"text-gray-500",children:e.asset_class}),(0,u.jsx)("span",{className:"text-lg font-bold text-lime-600",children:null!==e.mcda_score&&void 0!==e.mcda_score?e.mcda_score.toFixed(1):"N/A"})]})]})})},e.id)})}):(0,u.jsx)(x,{projects:t,groupBy:g,onProjectUpdated:v})]})}}},function(e){e.O(0,[762,789,12,417,971,529,744],function(){return e(e.s=9589)}),_N_E=e.O()}]);