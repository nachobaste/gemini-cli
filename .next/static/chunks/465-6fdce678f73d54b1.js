"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[465],{9465:function(e,r,t){t.d(r,{k:function(){return d}});var n=t(4513),a=t(90),c=t(5685),s=t(26),u=t(5977),o=t.n(u);function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function p(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var f=(0,t(2276).eI)("https://iemhwwufuffbwgrzusjt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllbWh3d3VmdWZmYndncnp1c2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMjYxMzEsImV4cCI6MjA2NjcwMjEzMX0.bhG23WjRqUE7AS18n-wYKJ1_Hx-_cuDJu8okON1e5cs"),l=function(e){if(e){if("string"==typeof e){var r=e.match(/\(([^,]+),([^)]+)\)/);if(r){var t=parseFloat(r[1]),n=parseFloat(r[2]);if(!isNaN(t)&&!isNaN(n))return{x:t,y:n}}}else if("object"==typeof e&&null!==e&&"number"==typeof e.x&&"number"==typeof e.y)return{x:e.x,y:e.y}}},d=function(){var e,r,t,n,u,i,d,v,h,m,w,b,x,y,k,g,_,j;function Z(){(0,c.Z)(this,Z)}return(0,s.Z)(Z,null,[{key:"getProjects",value:(e=(0,a.Z)(o().mark(function e(r,t){var n,c,s,u,i,d,v=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=(n=v.length>2&&void 0!==v[2]?v[2]:f).from("projects").select("*, mcda_evaluations(*, mcda_parameters(*))").order("created_at",{ascending:!1}),r&&(c=c.eq("asset_class",r)),t&&(c=c.eq("development_category",t)),e.next=6,c;case 6:if(u=(s=e.sent).data,!(i=s.error)){e.next=11;break}throw i;case 11:return e.next=13,Promise.all(u.map(function(){var e=(0,a.Z)(o().mark(function e(r){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.calculateMCDAScore(r.id,n);case 2:return t=e.sent,console.log("Project ".concat(r.id," MCDA Score:"),t),e.abrupt("return",p(p({},r),{},{coordinates:l(r.coordinates),mcda_score:t}));case 5:case"end":return e.stop()}},e)}));return function(r){return e.apply(this,arguments)}}()));case 13:return d=e.sent,e.abrupt("return",d);case 15:case"end":return e.stop()}},e)})),function(r,t){return e.apply(this,arguments)})},{key:"getProject",value:(r=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.from("projects").select("*, mcda_evaluations(*, mcda_parameters(*)), business_model_canvas(*)").eq("id",r).single();case 3:if(a=(n=e.sent).data,!(c=n.error)){e.next=8;break}throw c;case 8:return e.abrupt("return",p(p({},a),{},{coordinates:l(a.coordinates)}));case 9:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"createProject",value:(t=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s,u=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>1&&void 0!==u[1]?u[1]:f,e.next=3,t.auth.getUser();case 3:if(n=e.sent.data.user){e.next=7;break}throw Error("User not authenticated");case 7:return e.next=9,t.from("projects").insert(p(p({},r),{},{created_by:n.id})).select().single();case 9:if(c=(a=e.sent).data,!(s=a.error)){e.next=14;break}throw s;case 14:return e.abrupt("return",c);case 15:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})},{key:"updateProject",value:(n=(0,a.Z)(o().mark(function e(r,t){var n,a,c,s,u=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:f,e.next=3,n.from("projects").update(t).eq("id",r).select().single();case 3:if(c=(a=e.sent).data,!(s=a.error)){e.next=8;break}throw s;case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}},e)})),function(e,r){return n.apply(this,arguments)})},{key:"deleteProject",value:(u=(0,a.Z)(o().mark(function e(r){var t,n,a=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:f,e.next=3,t.from("projects").delete().eq("id",r);case 3:if(!(n=e.sent.error)){e.next=7;break}throw n;case 7:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)})},{key:"getMCDAParameters",value:(i=(0,a.Z)(o().mark(function e(){var r,t,n,a,c=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>0&&void 0!==c[0]?c[0]:f,e.next=3,r.from("mcda_parameters").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});case 3:if(n=(t=e.sent).data,!(a=t.error)){e.next=8;break}throw a;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)})},{key:"getMCDAParametersByCategory",value:(d=(0,a.Z)(o().mark(function e(){var r,t,n,a,c=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>0&&void 0!==c[0]?c[0]:f,e.next=3,r.rpc("get_mcda_parameters_by_category");case 3:if(n=(t=e.sent).data,!(a=t.error)){e.next=8;break}throw a;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)})),function(){return d.apply(this,arguments)})},{key:"updateMCDAParameters",value:(v=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s,u=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>1&&void 0!==u[1]?u[1]:f,n=r.map(function(e){return{id:e.id,weight:e.weight}}),e.next=4,t.from("mcda_parameters").upsert(n,{onConflict:"id"}).select();case 4:if(c=(a=e.sent).data,!(s=a.error)){e.next=9;break}throw s;case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}},e)})),function(e){return v.apply(this,arguments)})},{key:"getProjectEvaluations",value:(h=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.rpc("get_project_evaluations",{project_uuid:r});case 3:if(a=(n=e.sent).data,!(c=n.error)){e.next=8;break}throw c;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e){return h.apply(this,arguments)})},{key:"upsertMCDAEvaluation",value:(m=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.rpc("upsert_mcda_evaluation",{p_project_id:r.project_id,p_parameter_id:r.parameter_id,p_value:r.value,p_notes:r.notes});case 3:if(a=(n=e.sent).data,!(c=n.error)){e.next=8;break}throw c;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e){return m.apply(this,arguments)})},{key:"calculateMCDAScore",value:(w=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.rpc("calculate_mcda_score",{project_uuid:r});case 3:if(a=(n=e.sent).data,!(c=n.error)){e.next=8;break}throw c;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e){return w.apply(this,arguments)})},{key:"getBMC",value:(b=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.from("business_model_canvas").select("*").eq("project_id",r).single();case 3:if(a=(n=e.sent).data,!((c=n.error)&&"PGRST116"!==c.code)){e.next=8;break}throw c;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e){return b.apply(this,arguments)})},{key:"upsertBMC",value:(x=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.from("business_model_canvas").upsert(r).select().single();case 3:if(a=(n=e.sent).data,!(c=n.error)){e.next=8;break}throw c;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e){return x.apply(this,arguments)})},{key:"getBMCTemplates",value:(y=(0,a.Z)(o().mark(function e(){var r,t,n,a,c=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>0&&void 0!==c[0]?c[0]:f,e.next=3,r.from("business_model_canvas").select("*").is("project_id",null);case 3:if(n=(t=e.sent).data,!(a=t.error)){e.next=8;break}throw a;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)})),function(){return y.apply(this,arguments)})},{key:"getMunicipalities",value:(k=(0,a.Z)(o().mark(function e(){var r,t,n,a,c=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>0&&void 0!==c[0]?c[0]:f,e.next=3,r.from("municipalities").select("*").order("name",{ascending:!0});case 3:if(n=(t=e.sent).data,!(a=t.error)){e.next=8;break}throw a;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)})),function(){return k.apply(this,arguments)})},{key:"searchProjects",value:(g=(0,a.Z)(o().mark(function e(r,t,n){var a,c,s,u,i=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>3&&void 0!==i[3]?i[3]:f,e.next=3,a.rpc("search_projects",{search_term:r,status_filter:t,asset_class_filter:n});case 3:if(s=(c=e.sent).data,!(u=c.error)){e.next=8;break}throw u;case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}},e)})),function(e,r,t){return g.apply(this,arguments)})},{key:"getUserProfile",value:(_=(0,a.Z)(o().mark(function e(r){var t,n,a,c,s=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:f,e.next=3,t.from("user_profiles").select("*").eq("id",r).single();case 3:if(a=(n=e.sent).data,!((c=n.error)&&"PGRST116"!==c.code)){e.next=8;break}throw c;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e)})),function(e){return _.apply(this,arguments)})},{key:"updateUserProfile",value:(j=(0,a.Z)(o().mark(function e(r,t){var n,a,c,s,u=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:f,e.next=3,n.from("user_profiles").upsert(p({id:r},t)).select().single();case 3:if(c=(a=e.sent).data,!(s=a.error)){e.next=8;break}throw s;case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}},e)})),function(e,r){return j.apply(this,arguments)})}]),Z}()}}]);